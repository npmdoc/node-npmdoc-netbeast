<div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a

        href="https://github.com/netbeast/api"

    >netbeast (v1.1.0)</a>
</h1>
<h4>Resources for node.js wrapper</h4>
<div class="apidocSectionDiv"><a
    href="#apidoc.tableOfContents"
    id="apidoc.tableOfContents"
><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.netbeast">module netbeast</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.netbeast.netbeast">
            function <span class="apidocSignatureSpan"></span>netbeast
            <span class="apidocSignatureSpan">(topic)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.netbeast.discoverDevices">
            function <span class="apidocSignatureSpan">netbeast.</span>discoverDevices
            <span class="apidocSignatureSpan">(app)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.netbeast.emit">
            function <span class="apidocSignatureSpan">netbeast.</span>emit
            <span class="apidocSignatureSpan">(msg)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.netbeast.error">
            function <span class="apidocSignatureSpan">netbeast.</span>error
            <span class="apidocSignatureSpan">(body, title)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.netbeast.find">
            function <span class="apidocSignatureSpan">netbeast.</span>find
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.netbeast.info">
            function <span class="apidocSignatureSpan">netbeast.</span>info
            <span class="apidocSignatureSpan">(body, title)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.netbeast.on">
            function <span class="apidocSignatureSpan">netbeast.</span>on
            <span class="apidocSignatureSpan">(topic, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.netbeast.scan">
            function <span class="apidocSignatureSpan">netbeast.</span>scan
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.netbeast.set">
            function <span class="apidocSignatureSpan">netbeast.</span>set
            <span class="apidocSignatureSpan">(networkObject)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.netbeast.success">
            function <span class="apidocSignatureSpan">netbeast.</span>success
            <span class="apidocSignatureSpan">(body, title)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.netbeast.warning">
            function <span class="apidocSignatureSpan">netbeast.</span>warning
            <span class="apidocSignatureSpan">(body, title)</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.netbeast" id="apidoc.module.netbeast">module netbeast</a></h1>


    <h2>
        <a href="#apidoc.element.netbeast.netbeast" id="apidoc.element.netbeast.netbeast">
        function <span class="apidocSignatureSpan"></span>netbeast
        <span class="apidocSignatureSpan">(topic)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function netbeast(topic) {
  var self = {}
  self.props = {}
  self.props.topic = topic
  self.props.location = null
  self.props.alias = null
  self.props.group = null
  // definiciones

  // Add a device to a given scene
  self.addDeviceScene = function (deviceid) {
    return request.get(HTTP_API).query({ id: deviceid })
    .then(function (res) {
      if (!res.body.length) return Promise.reject(&#x27;These resources doesn´t exists!&#x27;)
      return request.get(APP_PROXY + res.body[0].app + res.body[0].hook)
      .then(function (res) {
        //  Registra dispositivo en la escena
        var device = {
          id: deviceid,
          sceneid: self.props.topic,
          location: self.props.location,
          state: JSON.stringify(res.body)
        }
        return request.post(HTTP_SCENES).send(device).promise()
      })
    })
  }

  //  Specified the alias of the objects
  self.alias = function (alias) {
    self.props.alias = alias
    return self
  }

  // Apply the values saved on a Scene
  self.applyScene = function () {
    if (!self.props.topic) return Promise.reject(&#x27;There isn´t any scene selected&#x27;)
    return self.getScene()
    .then(function (res) {
      res.body.forEach(function (device) {
        return self.setById(device.id, JSON.parse(device.state))
      })
    })
  }

  //  Specified the location of the objects
  self.at = function (location) {
    self.props.location = location
    return self
  }

  self.changeAlias = function (alias) {
    if (!alias) return Promise.reject(new Error(&#x27;Alias required --&#x3e; netbeast(&#x3c;id&#x3e;).changeAlias(&#x3c;alias&#x3e;)&#x27;))
    if (!self.props.topic) return Promise.reject(new Error(&#x27;Id required --&#x3e; netbeast(&#x3c;id&#x3e;).changeAlias(&#x3c;alias&#x3e;)&#x27;))

    return request.patch(HTTP_API + &#x27;?id=&#x27; + self.props.topic).send({alias: alias}).promise()
  }

  self.changeLocation = function (location) {
    if (!location) return Promise.reject(new Error(&#x27;Location required --&#x3e; netbeast(&#x3c;id&#x3e;).changeLocation(&#x3c;location&#x3e;)&#x27;))
    if (!self.props.topic) return Promise.reject(new Error(&#x27;Id required --&#x3e; netbeast(&#x3c;id&#x3e;).changeLocation(&#x3c;location&#x3e;)&#x27;))

    return request.patch(HTTP_API + &#x27;?id=&#x27; + self.props.topic).send({location: location}).promise()
  }

  self.create = function (args) {
    if (!self.props.topic &#x26;&#x26; !args.topic) return Promise.reject(new Error(&#x27;Topic required&#x27;))
    if (!args.hook) return Promise.reject(new Error(&#x27;Hook required&#x27;))
    if (!args.app) return Promise.reject(new Error(&#x27;App name required&#x27;))

    return request.post(HTTP_API).send(queryCustom(args)).promise()
  }

  //  Create a Scene with the given sates of the devices
  self.createCustomScene = function (states) {
    return Promise.map(states, function (device, done) {
      //  Registra dispositivo en la escena
      device.sceneid = self.props.topic
      device.state = JSON.stringify(device.status)
      for (var key in device) {
        if ([&#x27;id&#x27;, &#x27;sceneid&#x27;, &#x27;state&#x27;].indexOf(key) &#x3c; 0) delete device[key]
      }
      return request.post(HTTP_SCENES).send(device).promise()
    })
  }

  // Create a Scene with the current sates of the devices
  self.createScene = function (devicesid) {
    return Promise.map(devicesid, function (id) {
      self.addDeviceScene(id)
    })
  }

  //  Method that performs the delete request
  self.delete = function (args) {
    const queryString = queryCustom(normalizeArguments(args))
    return request.del(HTTP_API).query(queryString).promise()
  }

  //  Method that performs the delete request for a specific device
  self.deleteById = function (id) {
    return request.del(HTTP_API).query({ id: id }).promise()
  }

  //  Method that performs the delete request for a specific device
  self.deleteByAlias = function (alias) {
    return request.del(HTTP_API).query({ alias: alias }).promise()
  }

  //  Delete a device from a Scene
  self.deleteDeviceScene = function (deviceid) {
    return request.del(HTTP_SCENES).query({sceneid: self.props.topic, id: deviceid}).promise()
  }

  //  Delete a Scene
  self.deleteScene = function () {
    return request.del(HTTP_SCENES).query({sceneid: self.props.topic}). ...</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.netbeast.discoverDevices" id="apidoc.element.netbeast.discoverDevices">
        function <span class="apidocSignatureSpan">netbeast.</span>discoverDevices
        <span class="apidocSignatureSpan">(app)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">discoverDevices = function (app) {
  var apps = []
  var promise = new Promise(function (resolve, reject) {
    request.get(process.env.NETBEAST + &#x27;/plugins&#x27;)
    .then(function (res) {
      for (var aplication in res.body) {
        if (apps.indexOf(res.body[aplication].name) &#x3c; 0) apps.push(res.body[aplication].name)
      }

      if (!app || app === &#x27;all&#x27;) {
        return Promise.each(apps, function (item) {
          request.get(APP_PROXY + item + &#x27;/discover&#x27;).promise()
        })
      } else if (apps.indexOf(app) &#x3e;= 0) {
        return request.get(APP_PROXY + app + &#x27;/discover&#x27;)
      } else {
        return reject(new Error(&#x27;App not supported yet&#x27;))
      }
    })
  })
  return promise
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

  /* Select a second netbeast */
  if (networkObjects[1])  {
    netbeast.set(networkObjects[1])
  }

  console.log(&#x27;Discovering devices within the network&#x27;)
  netbeast.<span class="apidocCodeKeywordSpan">discoverDevices</span>(&#x27;all&#x27;).then(function (devices ) {
    console.log(devices)
  })

}).catch(function (err) {
  console.error(err)
})
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.netbeast.emit" id="apidoc.element.netbeast.emit">
        function <span class="apidocSignatureSpan">netbeast.</span>emit
        <span class="apidocSignatureSpan">(msg)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">emit = function (msg) {
  // Log notification through console
  var str = chalk.bgCyan(&#x27;ws&#x27;) +
  chalk.bold.bgCyan(msg.title || &#x27;::&#x27;)

  switch (msg.emphasis) {
    case &#x27;error&#x27;:
    str = str + chalk.bgRed(msg.body)
    break
    case &#x27;warning&#x27;:
    str = str + chalk.bgYellow(msg.body)
    break
    case &#x27;info&#x27;:
    str = str + chalk.bgBlue(msg.body)
    break
    case &#x27;success&#x27;:
    str = str + chalk.bgGreen(msg.body)
    break
  }

  var client = mqtt.connect(&#x27;ws://&#x27; + process.env.NETBEAST)
  console.log(str)
  client.publish(&#x27;netbeast/push&#x27;, JSON.stringify(msg))
  client.end()
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  var client = mqtt.connect(&#x27;ws://&#x27; + process.env.NETBEAST)
  console.log(str)
  client.publish(&#x27;netbeast/push&#x27;, JSON.stringify(msg))
  client.end()
}

netbeast.error = function (body, title) {
  netbeast.<span class="apidocCodeKeywordSpan">emit</span>({ emphasis: &#x27;error&#x27;, body: body, title: title })
}

netbeast.info = function (body, title) {
  netbeast.emit({ emphasis: &#x27;info&#x27;, body: body, title: title })
}

netbeast.success = function (body, title) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.netbeast.error" id="apidoc.element.netbeast.error">
        function <span class="apidocSignatureSpan">netbeast.</span>error
        <span class="apidocSignatureSpan">(body, title)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">error = function (body, title) {
  netbeast.emit({ emphasis: &#x27;error&#x27;, body: body, title: title })
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    var arr = window.location.href.split(&#x27;/&#x27;)
    return arr[2]

  } else if (process.env.NETBEAST) {
    return process.env.NETBEAST

  } else {
    console.<span class="apidocCodeKeywordSpan">error</span>(&#x27;Netbeast router URL is missing or device cannot be found&#x27
;)
    process.exit(-1)
  }
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.netbeast.find" id="apidoc.element.netbeast.find">
        function <span class="apidocSignatureSpan">netbeast.</span>find
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">find = function () {
  if (process.env.NETBEAST) return Promise.resolve(process.env.NETBEAST)
  return netbeast.scan()
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...






netbeast = require(&#x27;..&#x27;)
netbeast.<span class="apidocCodeKeywordSpan">find</span>().then(function (networkObjects) {
console.log(&#x27;network objects available with the following fields&#x27;)
console.log(networkObjects)

/* Select a second netbeast */
if (networkObjects[1])  {
  netbeast.set(networkObjects[1])
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.netbeast.info" id="apidoc.element.netbeast.info">
        function <span class="apidocSignatureSpan">netbeast.</span>info
        <span class="apidocSignatureSpan">(body, title)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">info = function (body, title) {
  netbeast.emit({ emphasis: &#x27;info&#x27;, body: body, title: title })
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.netbeast.on" id="apidoc.element.netbeast.on">
        function <span class="apidocSignatureSpan">netbeast.</span>on
        <span class="apidocSignatureSpan">(topic, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">on = function (topic, callback) {
  var client = mqtt.connect(&#x27;ws://&#x27; + process.env.NETBEAST)

  client.on(&#x27;connect&#x27;, function () {
    console.log(&#x27;connected&#x27;)
    client.subscribe(&#x27;netbeast/&#x27; + topic)
  })

  if (!topic) return Promise.reject(new Error(&#x27;Topic required&#x27;))

  client.on(&#x27;message&#x27;, function (topic, message) {
    console.log(message)
    if (message) {
      message = JSON.parse(message.toString())
      callback(null, message)
    }
  })
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    request.patch(HTTP_API).query({id: item}).send({groupname: name}).promise()
  })
}

self.publish = function (message) {
  var client = mqtt.connect(&#x27;ws://&#x27; + process.env.NETBEAST)

  client.<span class="apidocCodeKeywordSpan">on</span>(&#x27;connect&#x27;, function () {
    client.publish(&#x27;netbeast/&#x27; + self.props.topic, JSON.stringify({message}))
  })
}

//  Method that performs the set request
self.set = function (args) {
  return request.post(HTTP_API + &#x27;/topic/&#x27; + self.props.topic).query(queryCustom()).send(args).promise()
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.netbeast.scan" id="apidoc.element.netbeast.scan">
        function <span class="apidocSignatureSpan">netbeast.</span>scan
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">scan = function () {
  return new Promise(function (resolve, reject) {
    scan(function (beast) {
      if (beast &#x26;&#x26; beast[0]) {
        netbeast.set(beast[0]) // set environment variable
        return resolve(beast)
      }

      return reject(new Error(&#x27;No netbeasts found in subnet&#x27;))
    })
  })
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
      return reject(new Error(&#x27;No netbeasts found in subnet&#x27;))
    })
  })
}

netbeast.find = function () {
  if (process.env.NETBEAST) return Promise.resolve(process.env.NETBEAST)
  return netbeast.<span class="apidocCodeKeywordSpan">scan</span>()
}

netbeast.set = function (networkObject) {
  process.env.NETBEAST = networkObject.address + &#x27;:&#x27; + networkObject.port
  return netbeast
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.netbeast.set" id="apidoc.element.netbeast.set">
        function <span class="apidocSignatureSpan">netbeast.</span>set
        <span class="apidocSignatureSpan">(networkObject)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">set = function (networkObject) {
  process.env.NETBEAST = networkObject.address + &#x27;:&#x27; + networkObject.port
  return netbeast
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  return self
}

netbeast.scan = function () {
  return new Promise(function (resolve, reject) {
    scan(function (beast) {
      if (beast &#x26;&#x26; beast[0]) {
        netbeast.<span class="apidocCodeKeywordSpan">set</span>(beast[0]) // set environment variable
        return resolve(beast)
      }

      return reject(new Error(&#x27;No netbeasts found in subnet&#x27;))
    })
  })
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.netbeast.success" id="apidoc.element.netbeast.success">
        function <span class="apidocSignatureSpan">netbeast.</span>success
        <span class="apidocSignatureSpan">(body, title)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">success = function (body, title) {
  netbeast.emit({ emphasis: &#x27;success&#x27;, body: body, title: title })
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.netbeast.warning" id="apidoc.element.netbeast.warning">
        function <span class="apidocSignatureSpan">netbeast.</span>warning
        <span class="apidocSignatureSpan">(body, title)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">warning = function (body, title) {
  netbeast.emit({ emphasis: &#x27;warning&#x27;, body: body, title: title })
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
